var extendedDesc = {
	1: '',
	2: '',
}

var mapchunks = {
	0: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 'ct-all-routes.kml',
		el: ''
	},
	1: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '39.439340',
		lon: '-105.162767',
		zoom: 11,
		url: 's1route.kml',
		el: ''
	},
	2: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's2route.kml',
		el: ''
	},
	3: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's3route.kml',
		el: ''
	},
	4: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's4route.kml',
		el: ''
	},
	5: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's5route.kml',
		el: ''
	},
	6: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's6route.kml',
		el: ''
	},
	7: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's7route.kml',
		el: ''
	},
	8: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's8route.kml',
		el: ''
	},
	9: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's9route.kml',
		el: ''
	},
	10: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's10route.kml',
		el: ''
	},
	11: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's11route.kml',
		el: ''
	},
	12: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's12route.kml',
		el: ''
	},
	13: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's13route.kml',
		el: ''
	},
	14: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's14route.kml',
		el: ''
	},
	15: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's15route.kml',
		el: ''
	},
	16: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's16route.kml',
		el: ''
	},
	17: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's17route.kml',
		el: ''
	},
	18: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's18route.kml',
		el: ''
	},
	19: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's19route.kml',
		el: ''
	},
	20: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's20route.kml',
		el: ''
	},
	21: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's21route.kml',
		el: ''
	},
	22: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's22route.kml',
		el: ''
	},
	23: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's23route.kml',
		el: ''
	},
	24: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's24route.kml',
		el: ''
	},
	25: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's25route.kml',
		el: ''
	},
	26: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's26route.kml',
		el: ''
	},
	27: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's27route.kml',
		el: ''
	},
	28: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 's28route.kml',
		el: ''
	},
	29: {
		name: 'The Colorado Trail Main Route',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 'ct-full-route.kmz',
		el: ''
	},
	30: {
		name: 'The Colorado Trail West Route',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.774177',
		lon: '-106.347318',
		zoom: 9,
		url: 'ct-west-route.kmz',
		el: ''
	}
}

var map;
var kmlBase = 'http://extras.denverpost.com/long-haul/kml/';
var layers = new Array;

function removeLayer(element,index,array) {
	layers[index].setMap(null);
}

function setMapLinks(seg) {

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];

	var next = seg + 1;
	var prev = seg - 1;
	var next = (next == 31) ? 0 : next;
	var prev = (prev == -1) ? 30 : prev;
	var pageCurr = 'li#seg' + seg;

	$('a#mapNext').attr('href','javascript:mapSeg(' + next + ')');
	$('a#mapPrev').attr('href','javascript:mapSeg(' + prev + ')');
	$('a#segNextPage').attr('href','javascript:mapSeg(' + next + ')');
	$('a#segPrevPage').attr('href','javascript:mapSeg(' + prev + ')');
	$('.pagination > .current').removeClass('current');
	$(pageCurr).addClass('current');
}

function mapCreate(seg) {

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];
	
	var mapZoom = null;

	var mapOptions = {
		zoom: segment['zoom'],
		disableDefaultUI: true,
		panControl: false,
		mapTypeControl: false,
		scaleControl: true,
		streetViewControl: false,
		overviewMapControl: false,
		zoomControl: true,
		zoomControlOptions: {
			style: google.maps.ZoomControlStyle.SMALL
		},
		center: new google.maps.LatLng(segment['lat'],segment['lon']),
		mapTypeId: google.maps.MapTypeId.TERRAIN
	};
	
	map = new google.maps.Map(document.getElementById('map'), mapOptions);

/* layer toggles */
	layers.forEach(removeLayer);

	newLayer = new google.maps.KmlLayer({url: kmlBase + segment['url'], preserveViewport: true});
	layers[seg] = newLayer;
	layers[seg].setMap(map);

	setMapLinks(seg);

	$('#segTitle').html(segment['name']);
	$('#segDesc').html(segment['desc']);

	google.maps.event.addListener(map, 'idle', function(){ console.log(map.getZoom() + ', ' + map.getCenter()) });
}

function mapSeg(seg) {

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];

	layers.forEach(removeLayer);

	newLayer = new google.maps.KmlLayer({url: kmlBase + segment['url'], preserveViewport: true});
	layers[seg] = newLayer;
	console.log(seg);
	console.log(layers[seg]);
	layers[seg].setMap(map);

	var newLatLng = new google.maps.LatLng(segment['lat'],segment['lon']);
	map.setZoom(segment['zoom']);
	map.panTo(newLatLng);

	setMapLinks(seg);

	$('#segTitle').html(segment['name']);
	$('#segDesc').html(segment['desc']);

	scrollDownTo('#map');

}

function toggleLayer(i,caller) {
	if(layers[i].getMap() === null) {
		layers[i].setMap(map);
		$(caller).removeClass('unselected');
		$(caller).addClass('selected');
		$('wrapper-dropdown-1').removeClass('active');
	} else {
		layers[i].setMap(null);
		$(caller).removeClass('selected');
		$(caller).addClass('unselected');
		$('wrapper-dropdown-1').removeClass('active');
	}
}

/* end layer toggles */


function getUrlVars() {
	var vars = {};
	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		vars[key] = value;
	});
	return vars;
}

function centerFire(newcenter,caller) {
	map.setCenter(new google.maps.LatLng(newcenter[1],newcenter[2]));
	map.setZoom(newcenter[0]);
	$('#dd2 > ul.dropdown > li > a').removeClass('selected').addClass('unselected');
	$(caller).removeClass('unselected').addClass('selected');
	$('wrapper-dropdown-1').removeClass('active');
}
