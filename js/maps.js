var mapchunks = {
	0: {
		name: 'The Colorado Trail',
		desc: 'All 486 miles of The Colorado Trail, as well as the 80-mile Collegiate West trail. Navigate through maps of each segment using the arrows above or the links below. The five Collegiate West trail segments are after the 28 segments of the main trail.',
		notes: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 'ct-all-routes.kml',
		elimg: 'elevation-all.png',
		elmin: '5,505',
		elmax: '13,264',
		elgain: '89,354'
	},
	1: {
		name: 'CT Segment 1',
		desc: 'Kassler to South Platte Canyon &mdash; 16.8 miles',
		notes: 'The Colorado Trail&rsquo;s northern trailhead at Waterton Canyon will be crowded with hikers and cyclists as it travels on a mostly flat road paralleling the South Platte River through the canyon.',
		lat: '39.449150',
		lon: '-105.138734',
		zoom: 11,
		url: 's1route.kmz',
		elimg: 'elev-ct-1.png',
		elmin: '5,505',
		elmax: '7,516',
		elgain: '2,338'
	},
	2: {
		name: 'CT Segment 2',
		desc: 'South Platte Canyon to Colorado Trailhead FS 550 &mdash; 11.5 miles',
		notes: 'The majority of this segment passes through the old Buffalo Creek Burn. There&rsquo;s not much shade, nor water, but there is relief in pine forests at either end of the segment. Water is available from a spigot at the Elk Creek fire station.',
		lat: '39.376788',
		lon: '-105.215726',
		zoom: 11,
		url: 's2route.kmz',
		elimg: 'elev-ct-2.png',
		elmin: '6,148',
		elmax: '7,858',
		elgain: '1,981'
	},
	3: {
		name: 'CT Segment 3',
		desc: 'Colorado Trailhead FS 550 to FS 560 (Wellington Lake Road) &mdash; 12.2 miles',
		notes: 'Here the trail rolls through ponderosa pine and aspen groves, and many small streams, on wonderful singletrack. Expect lots of company from mountain bikers, hikers and trail runners.',
		lat: '39.336438',
		lon: '-105.321126',
		zoom: 11,
		url: 's3route.kmz',
		elimg: 'elev-ct-3.png',
		elmin: '7,385',
		elmax: '8,307',
		elgain: '1,268'
	},
	4: {
		name: 'CT Segment 4',
		desc: 'FS 560 (Wellington Lake Road) to Long Gulch &mdash; 16.6 miles',
		notes: 'This quiet segment enters the Lost Creek Wilderness. Lost Creek runs through a six-mile-long meadow &mdash; aptly named Long Gulch &mdash; rimmed by pine forest.',
		lat: '39.337500',
		lon: '-105.506864',
		zoom: 11,
		url: 's4route.kmz',
		elimg: 'elev-ct-4.png',
		elmin: '8,294',
		elmax: '10,978',
		elgain: '3,123'
	},
	5: {
		name: 'CT Segment 5',
		desc: 'Long Gulch to Kenosha Pass &mdash; 15.1 miles',
		notes: 'In the open country in this segment, near Kenosha Pass, between stretches of aspen grove and forest, you&rsquo;ll catch views of South Park and some of the nearby peaks.',
		lat: '39.390322',
		lon: '-105.690192',
		zoom: 11,
		url: 's5route.kmz',
		elimg: 'elev-ct-5.png',
		elmin: '9,534',
		elmax: '10,528',
		elgain: '1,792'
	},
	6: {
		name: 'CT Segment 6',
		desc: 'Kenosha Pass to Goldhill Trailhead &mdash; 32.9 miles',
		notes: 'You&rsquo;ll find nice singletrack, lush forests and great meadows for camping between Kenosha Pass and Breckenridge. The horizon on Georgia Pass is dominated by pyramid-shaped Mount Guyot.',
		lat: '39.479417',
		lon: '-105.897565',
		zoom: 11,
		url: 's6route.kmz',
		elimg: 'elev-ct-6.png',
		elmin: '9,196',
		elmax: '11,873',
		elgain: '4,495'
	},
	7: {
		name: 'CT Segment 7',
		desc: 'Goldhill Trailhead to Copper Mountain &mdash; 12.8 miles',
		notes: 'High country, spectacular vistas. The trail crosses a ridge at 12,500 feet between Peaks 5 and 6 in the Tenmile Range. There&rsquo;s water near Breckenridge and Copper Mountain, but not much in between.',
		lat: '39.523127',
		lon: '-106.108365',
		zoom: 11,
		url: 's7route.kmz',
		elimg: 'elev-ct-7.png',
		elmin: '9,229',
		elmax: '12,503',
		elgain: '3,611'
	},
	8: {
		name: 'CT Segment 8',
		desc: 'Copper Mountain to Tennessee Pass &mdash; 25.4 miles',
		notes: 'This segment passes through Copper Mountain ski resort on nice singletrack and climbs Searle and Kokomo passes, both well above treeline. Janet&rsquo;s Cabin, available by reservation, sits just below Searle Pass. Camp Hale, the training site for the famous 10th Mountain Division, isn&rsquo;t far from Tennessee Pass.',
		lat: '39.431171',
		lon: '-106.234364',
		zoom: 11,
		url: 's8route.kmz',
		elimg: 'elev-ct-8.png',
		elmin: '9,337',
		elmax: '12,251',
		elgain: '3,909'
	},
	9: {
		name: 'CT Segment 9',
		desc: 'Tennessee Pass to Hagerman Pass Road &mdash; 13.6 miles',
		notes: 'The highlight of this segment is the great mountain scenery in the Holy Cross Wilderness. There&rsquo;s good camping in meadows and near streams and small lakes throughout, with one exception: Don&rsquo;t rely on Wurts Ditch, near Tennessee Pass, for water.',
		lat: '39.319707',
		lon: '-106.382680',
		zoom: 11,
		url: 's9route.kmz',
		elimg: 'elev-ct-9.png',
		elmin: '10,079',
		elmax: '11,729',
		elgain: '2,306'
	},
	10: {
		name: 'CT Segment 10',
		desc: 'Hagerman Pass Road to Halfmoon Creek &mdash; 13 miles',
		notes: 'Expect lots of day hikers in the Mt. Massive Wilderness. This is the main route to climb Mt. Massive, 14,421 feet. Because you spend most of your time in deep forest, many hikers call this the &ldquo;green tunnel.&rdquo;',
		lat: '39.213652',
		lon: '-106.418385',
		zoom: 11,
		url: 's10route.kmz',
		elimg: 'elev-ct-10.png',
		elmin: '10,108',
		elmax: '11,325',
		elgain: '2,310'
	},
	11: {
		name: 'CT Segment 11',
		desc: 'Half Moon Creek to Clear Creek Road &mdash; 21.5 miles',
		notes: 'More of the &ldquo;green tunnel,&rdquo; but along with the pine forest there are huge, beautiful aspen groves. You can divert to climb Colorado&rsquo;s highest peak, Mt. Elbert, in this segment. The Collegiate East and Collegiate West routes intersect at the tiny village of Twin Lakes.',
		lat: '39.085321',
		lon: '-106.344914',
		zoom: 11,
		url: 's11route.kmz',
		elimg: 'elev-ct-11.png',
		elmin: '8,947',
		elmax: '10,679',
		elgain: '2,212'
	},
	12: {
		name: 'CT Segment 12',
		desc: 'Clear Creek Road to North Cottonwood Creek &mdash; 18.5 miles',
		notes: 'Lots of up and down in this segment, including over the ridge of Waverly Mountain and down to beautiful streams like Pine Creek and Frenchman&rsquo;s Creek. Good camping around Harvard Lakes. At Pine Creek there&rsquo;s an option for a big, rugged detour to Missouri Basin.',
		lat: '38.946343',
		lon: '-106.260800',
		zoom: 11,
		url: 's12route.kmz',
		elimg: 'elev-ct-12.png',
		elmin: '8,911',
		elmax: '11,854',
		elgain: '4,274'
	},
	13: {
		name: 'CT Segment 13',
		desc: 'North Cottonwood Creek Road to Chalk Creek &mdash; 22.8 miles',
		notes: 'You&rsquo;ll have a good climb up to the shoulder of Mt. Yale, no matter which direction you come from, and an option to climb the peak itself. There are restrooms at the Avalanche Trailhead. The trail runs close to Mount Princeton Hot Springs. The resort has great ice cream at the store and will accept hiker boxes.',
		lat: '38.792644',
		lon: '-106.240888',
		zoom: 11,
		url: 's13route.kmz',
		elimg: 'elev-ct-13.png',
		elmin: '8,205',
		elmax: '11,926',
		elgain: '3,762'
	},
	14: {
		name: 'CT Segment 14',
		desc: 'Chalk Creek Trailhead to U.S. 50 &mdash; 20.4 miles',
		notes: 'This segment of the trail rolls along through beautiful aspen and pine forest &mdash; especially stunning in the autumn. From Monarch Pass, it&rsquo;s an easy hitch to Salida for rest, relaxation and resupply. The Monarch Crest Store on top of the pass has an awesome hiker box and serves up a mean chili dog.',
		lat: '38.631103',
		lon: '-106.234021',
		zoom: 11,
		url: 's14route.kmz',
		elimg: 'elev-ct-14.png',
		elmin: '8,415',
		elmax: '10,207',
		elgain: '2,963'
	},
	15: {
		name: 'CT Segment 15',
		desc: 'U.S. 50 to Marshall Pass &mdash; 14.3 miles',
		notes: 'A walk along the Continental Divide with spectacular views in all directions. There&rsquo;s much exposure to weather here, and once you leave U.S. 50 there are no real resupply points for 80 miles. Gunnison and Creede are the closest towns, and neither is within easy reach.',
		lat: '38.476992',
		lon: '-106.272473',
		zoom: 11,
		url: 's15route.kmz',
		elimg: 'elev-ct-15.png',
		elmin: '8,842',
		elmax: '11,932',
		elgain: '3,360'
	},
	16: {
		name: 'CT Segment 16',
		desc: 'Marshall Pass to Sargents Mesa &mdash; 15.2 miles',
		notes: 'The trail passes through meadow and forest, with big mountain views in the distance. Tank Seven Creek at the foot of Sargents Mesa are just about the only reliable water sources in this segment &mdash; though if you keep your eyes peeled, there are occasional small springs, seeps and stock tanks.',
		lat: '38.340326',
		lon: '-106.328092',
		zoom: 11,
		url: 's16route.kmz',
		elimg: 'elev-ct-16.png',
		elmin: '10,344',
		elmax: '11,834',
		elgain: '2,446'
	},
	17: {
		name: 'CT Segment 17',
		desc: 'Sargents Mesa to Colorado 114 &mdash; 20.4 miles',
		notes: 'Sargents Mesa is beautiful: high, wide, lonesome and mostly waterless. The forest, when you&rsquo;re in it, is filled with deadfall, wildflowers and berries of all flavors. Reliable water is available in tiny Razor Creek and at Baldy Lake.',
		lat: '38.278635',
		lon: '-106.484990',
		zoom: 11,
		url: 's17route.kmz',
		elimg: 'elev-ct-17.png',
		elmin: '9,734',
		elmax: '11,798',
		elgain: '2,122'
	},
	18: {
		name: 'CT Segment 18',
		desc: 'Colorado 114 to Saguache Park Road &mdash; 13.8 miles',
		notes: 'A high prairie walk on a mix of trail and rutted four-wheel-drive ranch roads through sagebrush, grass and pasture land. Expect cows! This section can often be hot, windy and exposed to the weather. Lujan Creek and Los Creek have water.',
		lat: '38.181411',
		lon: '-106.638455',
		zoom: 11,
		url: 's18route.kmz',
		elimg: 'elev-ct-18.png',
		elmin: '9,341',
		elmax: '10,292',
		elgain: '1,237'
	},
	19: {
		name: 'CT Segment 19',
		desc: 'Saguache Park Road to Eddiesville Trailhead &mdash; 13.7 miles',
		notes: 'More cows! More open country! Water is available in springs, one of them fenced off but accessible. Gradually the timber that has been only on the ridgelines creeps lower until you&rsquo;re walking through aspen and pines. You&rsquo;ll have to ford Cochetopa Creek, a major crossing in early season when the water&rsquo;s high.',
		lat: '38.075680',
		lon: '-106.775098',
		zoom: 11,
		url: 's19route.kmz',
		elimg: 'elev-ct-19.png',
		elmin: '9,537',
		elmax: '10,449',
		elgain: '1,987'
	},
	20: {
		name: 'CT Segment 20',
		desc: 'Eddiesville Trailhead to San Luis Pass &mdash; 12.7 miles',
		notes: 'The remote La Garita Wilderness is spectacular, even though hundreds of square miles of the forest have been devastated by pine beetle kill. Water is plentiful. San Luis Peak, at 14,014 feet, is accessible by a hike from the trail.',
		lat: '37.998344',
		lon: '-106.894231',
		zoom: 11,
		url: 's20route.kmz',
		elimg: 'elev-ct-20.png',
		elmin: '10,371',
		elmax: '12,621',
		elgain: '2,793'
	},
	21: {
		name: 'CT Segment 21',
		desc: 'San Luis Pass to Spring Creek Pass &mdash; 14.9 miles',
		notes: 'Although there are brief sections with trees for shelter, the trail between San Luis Pass and Spring Creek Pass is high and exposed. It travels the Continental Divide at an average elevation above 12,000 feet. Snow Mesa, a broad, high, flat expanse, makes for a cautious crossing.',
		lat: '37.965059',
		lon: '-107.060056',
		zoom: 11,
		url: 's21route.kmz',
		elimg: 'elev-ct-21.png',
		elmin: '10,925',
		elmax: '12,917',
		elgain: '2,778'
	},
	22: {
		name: 'CT Segment 22',
		desc: 'Spring Creek Pass to Carson Saddle &mdash; 17.2 miles',
		notes: 'In this segment you&rsquo;ll climb to Coney Summit, 13,271 feet, the highpoint of The Colorado Trail. The tiny alpine wildflowers are outrageously beautiful along this section. Because it&rsquo;s so high, water isn&rsquo;t readily available except in snowfields, from snowmelt ponds and tiny trickles of melt.',
		lat: '37.899798',
		lon: '-107.267766',
		zoom: 11,
		url: 's22route.kmz',
		elimg: 'elev-ct-22.png',
		elmin: '10,938',
		elmax: '13,264',
		elgain: '3,650'
	},
	23: {
		name: 'CT Segment 23',
		desc: 'Carson Saddle to Rio Grande Reservoir Road &mdash; 15.9 miles',
		notes: 'This is still high-altitude, remote country with little in the way of cover, outside of pockets of willows, should a storm blow in. Many hikers camp at Cataract Lake. Many moose!',
		lat: '37.834208',
		lon: '-107.459340',
		zoom: 11,
		url: 's23route.kmz',
		elimg: 'elev-ct-23.png',
		elmin: '11,903',
		elmax: '12,976',
		elgain: '4,335'
	},
	24: {
		name: 'CT Segment 24',
		desc: 'Rio Grande Reservoir Road to Molas Pass &mdash; 20.2 miles',
		notes: 'The trail between Stony Pass and Molas Pass is nothing short of spectacular &mdash; Colorado&rsquo;s wild mountain country at its finest. The tundra crossing is high and exposed, but it&rsquo;s also filled with vast fields of wildflowers. The Weminuche Wilderness is another awe-inspiring walk with water, water everywhere. This segment is epic.',
		lat: '37.750103',
		lon: '-107.614865',
		zoom: 11,
		url: 's24route.kmz',
		elimg: 'elev-ct-24.png',
		elmin: '8,930',
		elmax: '12,707',
		elgain: '3,880'
	},
	25: {
		name: 'CT Segment 25',
		desc: 'Molas Pass to Bolam Pass Road &mdash; 20.9 miles',
		notes: 'Between Molas Pass to Bolam Pass Road, the trail crosses fields of flowers framed by stunning views of the San Juan Mountains.',
		lat: '37.736801',
		lon: '-107.808843',
		zoom: 11,
		url: 's25route.kmz',
		elimg: 'elev-ct-25.png',
		elmin: '10,869',
		elmax: '12,470',
		elgain: '3,167'
	},
	26: {
		name: 'CT Segment 26',
		desc: 'Bolam Pass Road to Hotel Draw Road &mdash; 10.9 miles',
		notes: 'More high country and more climbing and descending as you make your way over Blackhawk Pass. Water should be plentiful here, but it&rsquo;s not. Straight Creek is the most reliable source.',
		lat: '37.682207',
		lon: '-107.954926',
		zoom: 11,
		url: 's26route.kmz',
		elimg: 'elev-ct-26.png',
		elmin: '10,338',
		elmax: '11,978',
		elgain: '1,126'
	},
	27: {
		name: 'CT Segment 27',
		desc: 'Hotel Draw Road to Cumberland Basin &mdash; 20.6 miles',
		notes: 'The trail crosses and utilizes a number of logging roads; it&rsquo;s not well marked. There&rsquo;s little water; some is available off trail via short, steep hikes to springs. Indian Trail Ridge, a narrow, above-treeline walk between the San Juan Mountains and the La Plata range, is a storm magnet.',
		lat: '37.539694',
		lon: '-108.001103',
		zoom: 11,
		url: 's27route.kmz',
		elimg: 'elev-ct-27.png',
		elmin: '10,469',
		elmax: '12,247',
		elgain: '2,911'
	},
	28: {
		name: 'CT Segment 28',
		desc: 'Kennebec Trailhead to Junction Creek Trailhead &mdash; 21.5 miles',
		notes: 'The stretches of the trail near Durango are crowded with day hikers, runners and cyclists in Canyon Creek, but the rest of the segment, on either side of Kennebec Pass, the trail is high, lush and quiet.',
		lat: '37.388725',
		lon: '-107.957501',
		zoom: 11,
		url: 's28route.kmz',
		elimg: 'elev-ct-28.png',
		elmin: '7,018',
		elmax: '11,791',
		elgain: '1,425'
	},
	29: {
		name: 'CW Segment 1',
		desc: 'Twin Lakes to Sheep Gulch &mdash; 9.8 miles',
		notes: 'This segment of the trail crosses Hope Pass, 12,548 feet. The trail is steep but the views on top are worth the climb.',
		lat: '39.042936',
		lon: '-106.382680',
		zoom: 11,
		url: 'cw1route.kmz',
		elimg: 'elev-cw-1.png',
		elmin: '9,232',
		elmax: '12,523',
		elgain: '3,606'
	},
	30: {
		name: 'CW Segment 2',
		desc: 'Sheep Gulch to Cottonwood Pass Road Trailhead &mdash; 25.2 miles',
		notes: 'Cross another high pass, Lake Ann Pass, at 12,588 feet, and enjoy some of the most beautiful country on the trail with views of the Three Apostles and Ice Mountain. This segment is a mix of high tundra country and low, lush forest and meadow, all carpeted with wildflowers.',
		lat: '38.916698',
		lon: '-106.452374',
		zoom: 11,
		url: 'cw2route.kmz',
		elimg: 'elev-cw-2.png',
		elmin: '9,856',
		elmax: '12,605',
		elgain: '4,912'
	},
	31: {
		name: 'CW Segment 3',
		desc: 'Cottonwood Pass Road Trailhead to Garden Basin Trailhead &mdash; 10.2 miles',
		notes: 'With the exception of Prospector Gulch and Texas Creek, this is all high country, rolling along between 10,000 and 12,000 feet with the majority on the higher end. Amazing views in all directions. There&rsquo;s much climbing and descending.',
		lat: '38.793713',
		lon: '-106.436925',
		zoom: 11,
		url: 'cw3route.kmz',
		elimg: 'elev-cw-3.png',
		elmin: '10,410',
		elmax: '12,123',
		elgain: '2,218'
	},
	32: {
		name: 'CW Segment 4',
		desc: 'Garden Basin Trailhead to Hancock Trailhead &mdash; 14.2 miles',
		notes: 'Lots more climbing and descending, with every ridge top revealing a new drainage, each more beautiful than the one preceding it. Walking on the old railroad grade of the Alpine Tunnel provides the easiest and lowest hiking on the Collegiate West.',
		lat: '38.694101',
		lon: '-106.413235',
		zoom: 11,
		url: 'cw4route.kmz',
		elimg: 'elev-cw-4.png',
		elmin: '10,860',
		elmax: '12,313',
		elgain: '2,853'
	},
	33: {
		name: 'CW Segment 5',
		desc: 'Hancock Trailhead to Ridge Above South Fooses Creek &mdash; 22.6 miles',
		notes: 'High lakes are a highlight in this segment: Hancock Lake, Trail Lake, Boss Lake. Be sure to look around at the ancient ruins of rock walls and hunting pits along the Continental Divide on Monarch Ridge.',
		lat: '38.547107',
		lon: '-106.343197',
		zoom: 11,
		url: 'cw5route.kmz',
		elimg: 'elev-cw-5.png',
		elmin: '10,410',
		elmax: '12,123',
		elgain: '4,889'
	}
}

var map;
var kmlBase = 'http://extras.denverpost.com/long-haul/kml/';
var layers = new Array;
var baseSet = false;

function removeLayer(element,index,array) {
	layers[index].setMap(null);
}

function mapHash() {
	if (window.location.hash) {
		var hash = parseInt(window.location.hash.toString().replace('#',''),10);
        if (hash <= 33 && hash >= 1) {
        	mapSeg(hash);
        }
    }
}

function setMapLinks(seg) {

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];

	var next = seg + 1;
	var prev = seg - 1;
	var next = (next == 33) ? 0 : next;
	var prev = (prev == -1) ? 33 : prev;
	var pageCurr = 'li#seg' + seg;

	var notesBuilt = ( segment['notes'].length > 5 ) ? '<strong>Dean&rsquo;s notes:</strong> ' + segment['notes'] : '';

	$('a#mapNext').attr('href','javascript:mapSeg(' + next + ')');
	$('a#mapPrev').attr('href','javascript:mapSeg(' + prev + ')');
	$('a#segPagNext').attr('href','javascript:mapSeg(' + next + ')');
	$('a#segPagPrev').attr('href','javascript:mapSeg(' + prev + ')');
	$('.pagination > .current').removeClass('current');
	$(pageCurr).addClass('current');
	$('#segTitle').html(segment['name']);
	$('#segDesc').html(segment['desc']);
	$('#Dnotes').html(notesBuilt);
	$('#elevpng').attr('src','./kml/' + segment['elimg']);
	$('#elmin').html('<strong>Min:</strong> ' + segment['elmin'] + ' feet');
	$('#elmax').html('<strong>Max:</strong> ' + segment['elmax'] + ' feet');
	$('#elgain').html('<strong>Gain:</strong> ' + segment['elgain'] + ' feet');
	var mapLink = window.location.href.split('#')[0] + '#' + seg;
	$('#mapLink').attr('value',mapLink);
	$('#mapLink').click(function(e) {
	    $(this).focus().select();
	    $(this).keypress(function(e){
		    e.preventDefault();
		});
    });
}

function mapCreate(seg,alone) {
	alone = typeof alone !== 'undefined' ? true : false;
	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];
	
	var mapZoom = null;

	var mapOptions = {
		zoom: segment['zoom'],
		disableDefaultUI: true,
		panControl: false,
		mapTypeControl: false,
		scaleControl: true,
		streetViewControl: false,
		overviewMapControl: false,
		zoomControl: true,
		zoomControlOptions: {
			style: google.maps.ZoomControlStyle.SMALL
		},
		center: new google.maps.LatLng(segment['lat'],segment['lon']),
		mapTypeId: google.maps.MapTypeId.TERRAIN
	};
	
	map = new google.maps.Map(document.getElementById('map'), mapOptions);

/* layer toggles */
	if (!alone) {
		layers.forEach(removeLayer);

		if (baseSet) {
			baseLayer.setMap(null);
			baseSet = false;
		}

		setMapLinks(seg);
	}

	newLayer = new google.maps.KmlLayer({
		url: kmlBase + segment['url'],
		preserveViewport: true,
		suppressInfoWindows: true,
		clickable: false
	});
	layers[seg] = newLayer;
	layers[seg].setMap(map);

	//google.maps.event.addListener(map, 'idle', function(){ console.log(map.getZoom() + ', ' + map.getCenter()) });

	mapHash();
}

function mapSeg(seg) {

	if (!baseSet) {
		baseLayer = new google.maps.KmlLayer({
			url: kmlBase + 'ct-all-routes-light.kml',
			preserveViewport: true,
			suppressInfoWindows: true,
			clickable: false
		});
		baseLayer.setMap(map);
		baseSet = true;
	}

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];

	layers.forEach(removeLayer);

	newLayer = new google.maps.KmlLayer({
		url: kmlBase + segment['url'],
		preserveViewport: true,
		suppressInfoWindows: true,
		clickable: false
	});
	layers[seg] = newLayer;
	layers[seg].setMap(map);

	var newLatLng = new google.maps.LatLng(segment['lat'],segment['lon']);
	map.setZoom(segment['zoom']);
	map.panTo(newLatLng);

	setMapLinks(seg);

	scrollDownTo('#map');
}

function toggleLayer(i,caller) {
	if(layers[i].getMap() === null) {
		layers[i].setMap(map);
		$(caller).removeClass('unselected');
		$(caller).addClass('selected');
		$('wrapper-dropdown-1').removeClass('active');
	} else {
		layers[i].setMap(null);
		$(caller).removeClass('selected');
		$(caller).addClass('unselected');
		$('wrapper-dropdown-1').removeClass('active');
	}
}

/* end layer toggles */


function getUrlVars() {
	var vars = {};
	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		vars[key] = value;
	});
	return vars;
}

function centerFire(newcenter,caller) {
	map.setCenter(new google.maps.LatLng(newcenter[1],newcenter[2]));
	map.setZoom(newcenter[0]);
	$('#dd2 > ul.dropdown > li > a').removeClass('selected').addClass('unselected');
	$(caller).removeClass('unselected').addClass('selected');
	$('wrapper-dropdown-1').removeClass('active');
}
