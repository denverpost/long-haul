var extendedDesc = {
	1: '',
	2: '',
}

var mapchunks = {
	0: {
		name: 'The Colorado Trail',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 'ct-all-routes.kml',
		el: ''
	},
	1: {
		name: 'CT Segment 1',
		desc: 'Segment 1',
		descex: '',
		lat: '39.449150',
		lon: '-105.138734',
		zoom: 12,
		url: 's1route.kmz',
		el: ''
	},
	2: {
		name: 'CT Segment 2',
		desc: 'Segment 2',
		descex: '',
		lat: '39.376788',
		lon: '-105.215726',
		zoom: 12,
		url: 's2route.kmz',
		el: ''
	},
	3: {
		name: 'CT Segment 3',
		desc: 'CT Segment 3',
		descex: '',
		lat: '39.336438',
		lon: '-105.321126',
		zoom: 12,
		url: 's3route.kmz',
		el: ''
	},
	4: {
		name: 'CT Segment 4',
		desc: 'CT Segment 4',
		descex: '',
		lat: '39.337500',
		lon: '-105.506864',
		zoom: 12,
		url: 's4route.kmz',
		el: ''
	},
	5: {
		name: 'CT Segment 5',
		desc: 'CT Segment 5',
		descex: '',
		lat: '39.390322',
		lon: '-105.690192',
		zoom: 12,
		url: 's5route.kmz',
		el: ''
	},
	6: {
		name: 'CT Segment 6',
		desc: 'CT Segment 6',
		descex: '',
		lat: '39.479417',
		lon: '-105.897565',
		zoom: 11,
		url: 's6route.kmz',
		el: ''
	},
	7: {
		name: 'CT Segment 7',
		desc: 'CT Segment 7',
		descex: '',
		lat: '39.523127',
		lon: '-106.108365',
		zoom: 12,
		url: 's7route.kmz',
		el: ''
	},
	8: {
		name: 'CT Segment 8',
		desc: 'CT Segment 8',
		descex: '',
		lat: '39.431171',
		lon: '-106.234364',
		zoom: 11,
		url: 's8route.kmz',
		el: ''
	},
	9: {
		name: 'CT Segment 9',
		desc: 'CT Segment 9',
		descex: '',
		lat: '39.319707',
		lon: '-106.382680',
		zoom: 12,
		url: 's9route.kmz',
		el: ''
	},
	10: {
		name: 'CT Segment 10',
		desc: 'CT Segment 10',
		descex: '',
		lat: '39.213652',
		lon: '-106.418385',
		zoom: 12,
		url: 's10route.kmz',
		el: ''
	},
	11: {
		name: 'CT Segment 11',
		desc: 'CT Segment 11',
		descex: '',
		lat: '39.085321',
		lon: '-106.344914',
		zoom: 12,
		url: 's11route.kmz',
		el: ''
	},
	12: {
		name: 'CT Segment 12',
		desc: 'CT Segment 12',
		descex: '',
		lat: '38.946343',
		lon: '-106.260800',
		zoom: 11,
		url: 's12route.kmz',
		el: ''
	},
	13: {
		name: 'CT Segment 13',
		desc: 'CT Segment 13',
		descex: '',
		lat: '38.792644',
		lon: '-106.240888',
		zoom: 11,
		url: 's13route.kmz',
		el: ''
	},
	14: {
		name: 'CT Segment 14',
		desc: 'CT Segment 14',
		descex: '',
		lat: '38.631103',
		lon: '-106.234021',
		zoom: 11,
		url: 's14route.kmz',
		el: ''
	},
	15: {
		name: 'CT Segment 15',
		desc: 'CT Segment 15',
		descex: '',
		lat: '38.476992',
		lon: '-106.272473',
		zoom: 11,
		url: 's15route.kmz',
		el: ''
	},
	16: {
		name: 'CT Segment 16',
		desc: 'CT Segment 16',
		descex: '',
		lat: '38.340326',
		lon: '-106.328092',
		zoom: 12,
		url: 's16route.kmz',
		el: ''
	},
	17: {
		name: 'CT Segment 17',
		desc: 'CT Segment 17',
		descex: '',
		lat: '38.278635',
		lon: '-106.484990',
		zoom: 12,
		url: 's17route.kmz',
		el: ''
	},
	18: {
		name: 'CT Segment 18',
		desc: 'CT Segment 18',
		descex: '',
		lat: '38.181411',
		lon: '-106.638455',
		zoom: 12,
		url: 's18route.kmz',
		el: ''
	},
	19: {
		name: 'CT Segment 19',
		desc: 'CT Segment 19',
		descex: '',
		lat: '38.075680',
		lon: '-106.775098',
		zoom: 12,
		url: 's19route.kmz',
		el: ''
	},
	20: {
		name: 'CT Segment 20',
		desc: 'CT Segment 20',
		descex: '',
		lat: '37.998344',
		lon: '-106.894231',
		zoom: 12,
		url: 's20route.kmz',
		el: ''
	},
	21: {
		name: 'CT Segment 21',
		desc: 'CT Segment 21',
		descex: '',
		lat: '37.965059',
		lon: '-107.060056',
		zoom: 12,
		url: 's21route.kmz',
		el: ''
	},
	22: {
		name: 'CT Segment 22',
		desc: 'CT Segment 22',
		descex: '',
		lat: '37.899798',
		lon: '-107.267766',
		zoom: 12,
		url: 's22route.kmz',
		el: ''
	},
	23: {
		name: 'CT Segment 23',
		desc: 'CT Segment 23',
		descex: '',
		lat: '37.834208',
		lon: '-107.459340',
		zoom: 12,
		url: 's23route.kmz',
		el: ''
	},
	24: {
		name: 'CT Segment 24',
		desc: 'CT Segment 24',
		descex: '',
		lat: '37.750103',
		lon: '-107.614865',
		zoom: 12,
		url: 's24route.kmz',
		el: ''
	},
	25: {
		name: 'CT Segment 25',
		desc: 'CT Segment 25',
		descex: '',
		lat: '37.736801',
		lon: '-107.808843',
		zoom: 12,
		url: 's25route.kmz',
		el: ''
	},
	26: {
		name: 'CT Segment 26',
		desc: 'CT Segment 26',
		descex: '',
		lat: '37.682207',
		lon: '-107.954926',
		zoom: 12,
		url: 's26route.kmz',
		el: ''
	},
	27: {
		name: 'CT Segment 27',
		desc: 'CT Segment 27',
		descex: '',
		lat: '37.539694',
		lon: '-108.001103',
		zoom: 11,
		url: 's27route.kmz',
		el: ''
	},
	28: {
		name: 'CT Segment 28',
		desc: 'CT Segment 28',
		descex: '',
		lat: '37.388725',
		lon: '-107.957501',
		zoom: 12,
		url: 's28route.kmz',
		el: ''
	},
	29: {
		name: 'Collegiate West Segment 1',
		desc: 'Collegiate West Segment 1',
		descex: '',
		lat: '39.042936',
		lon: '-106.382680',
		zoom: 12,
		url: 'cw1route.kmz',
		el: ''
	},
	30: {
		name: 'Collegiate West Segment 2',
		desc: 'Collegiate West Segment 2',
		descex: '',
		lat: '38.916698',
		lon: '-106.452374',
		zoom: 11,
		url: 'cw2route.kmz',
		el: ''
	},
	31: {
		name: 'Collegiate West Segment 3',
		desc: 'Collegiate West Segment 3',
		descex: '',
		lat: '38.793713',
		lon: '-106.436925',
		zoom: 12,
		url: 'cw3route.kmz',
		el: ''
	},
	32: {
		name: 'Collegiate West Segment 4',
		desc: 'Collegiate West Segment 4',
		descex: '',
		lat: '38.694101',
		lon: '-106.413235',
		zoom: 12,
		url: 'cw4route.kmz',
		el: ''
	},
	33: {
		name: 'Collegiate West Segment 5',
		desc: 'Collegiate West Segment 5',
		descex: '',
		lat: '38.547107',
		lon: '-106.343197',
		zoom: 11,
		url: 'cw5route.kmz',
		el: ''
	},
	34: {
		name: 'The Colorado Trail Main Route',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.452261',
		lon: '-106.358304',
		zoom: 8,
		url: 'ct-full-route.kmz',
		el: ''
	},
	35: {
		name: 'The Colorado Trail West Route',
		desc: 'This is the whole trail',
		descex: '',
		lat: '38.774177',
		lon: '-106.347318',
		zoom: 9,
		url: 'ct-west-route.kmz',
		el: ''
	}
}

var map;
var kmlBase = 'http://extras.denverpost.com/long-haul/kml/';
var layers = new Array;

function removeLayer(element,index,array) {
	layers[index].setMap(null);
}

function setMapLinks(seg) {

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];

	var next = seg + 1;
	var prev = seg - 1;
	var next = (next == 35) ? 0 : next;
	var prev = (prev == -1) ? 35 : prev;
	var pageCurr = 'li#seg' + seg;

	$('a#mapNext').attr('href','javascript:mapSeg(' + next + ')');
	$('a#mapPrev').attr('href','javascript:mapSeg(' + prev + ')');
	$('a#segPagNext').attr('href','javascript:mapSeg(' + next + ')');
	$('a#segPagPrev').attr('href','javascript:mapSeg(' + prev + ')');
	$('.pagination > .current').removeClass('current');
	$(pageCurr).addClass('current');
}

function mapCreate(seg) {

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];
	
	var mapZoom = null;

	var mapOptions = {
		zoom: segment['zoom'],
		disableDefaultUI: true,
		panControl: false,
		mapTypeControl: false,
		scaleControl: true,
		streetViewControl: false,
		overviewMapControl: false,
		zoomControl: true,
		zoomControlOptions: {
			style: google.maps.ZoomControlStyle.SMALL
		},
		center: new google.maps.LatLng(segment['lat'],segment['lon']),
		mapTypeId: google.maps.MapTypeId.TERRAIN
	};
	
	map = new google.maps.Map(document.getElementById('map'), mapOptions);

/* layer toggles */
	layers.forEach(removeLayer);

	newLayer = new google.maps.KmlLayer({url: kmlBase + segment['url'], preserveViewport: true});
	layers[seg] = newLayer;
	layers[seg].setMap(map);

	setMapLinks(seg);

	$('#segTitle').html(segment['name']);
	$('#segDesc').html(segment['desc']);

	google.maps.event.addListener(map, 'idle', function(){ console.log(map.getZoom() + ', ' + map.getCenter()) });
}

function mapSeg(seg) {

	seg = typeof seg !== 'undefined' ? seg : 0;
	segment = typeof seg !== 'undefined' ? mapchunks[seg] : mapchunks[0];

	layers.forEach(removeLayer);

	newLayer = new google.maps.KmlLayer({url: kmlBase + segment['url'], preserveViewport: true});
	layers[seg] = newLayer;
	console.log(seg);
	console.log(layers[seg]);
	layers[seg].setMap(map);

	var newLatLng = new google.maps.LatLng(segment['lat'],segment['lon']);
	map.setZoom(segment['zoom']);
	map.panTo(newLatLng);

	setMapLinks(seg);

	$('#segTitle').html(segment['name']);
	$('#segDesc').html(segment['desc']);

	scrollDownTo('#map');

}

function toggleLayer(i,caller) {
	if(layers[i].getMap() === null) {
		layers[i].setMap(map);
		$(caller).removeClass('unselected');
		$(caller).addClass('selected');
		$('wrapper-dropdown-1').removeClass('active');
	} else {
		layers[i].setMap(null);
		$(caller).removeClass('selected');
		$(caller).addClass('unselected');
		$('wrapper-dropdown-1').removeClass('active');
	}
}

/* end layer toggles */


function getUrlVars() {
	var vars = {};
	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		vars[key] = value;
	});
	return vars;
}

function centerFire(newcenter,caller) {
	map.setCenter(new google.maps.LatLng(newcenter[1],newcenter[2]));
	map.setZoom(newcenter[0]);
	$('#dd2 > ul.dropdown > li > a').removeClass('selected').addClass('unselected');
	$(caller).removeClass('unselected').addClass('selected');
	$('wrapper-dropdown-1').removeClass('active');
}
